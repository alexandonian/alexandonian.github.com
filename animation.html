<!DOCTYPE html>
<html>
<meta charset="utf-8"
<body>

	<!-- <div id="btns"> -->
	<button id="startbtn"></button>
	<!-- 		<div id="stopdiv"><button id="stopbtn">Stop</button></div> -->
	<!-- 	</div> -->
	<style type="text/css">
		html, body , button{
			height: 100%;
			background: #222;
			margin: 0;
		}

		body, #prev, #next {
			height: 100%;
			box-sizing: border-box;

			display: flex;
			flex-direction: column;
			justify-content: center;

			display: -webkit-flex;
			-webkit-flex-direction: column;
			-webkit-justify-content: center;
		}
		svg {
			margin: auto;
		}

	</style>
</body>
</html>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script type="text/javascript">

	var width = 800,
	height = 800,
	n = 8;

	var data = d3.range(0, n * n)
	.map(function(d, i) {
		var x = d % n,
		y = ~~(d / n);
		patch_name = "C:/Users/Administrator/Developer/alexandonian.github.io/patches90/class_num_4_image_name_090_patch_" + y + "_" + x + "_0.png"
		return { x: x/n, y: y/n, i: i, patch_name: patch_name };
	});

	var svg = d3.select("#startbtn").append("svg")
	.attr("width", width)
	.attr("height", height)
	.style("background", "#111");;

	// var text = svg.selectAll("text")
	// .data([0])
	// .enter()
	// .append("text")
	// .text("Testing")
	// .attr("x", "40")
	// .attr("y", "60");


	var squares = svg.selectAll("g")
	.data(data)
	.enter()
	.append("g");

	// var imgs = svg.selectAll("image").data([0]);
	// imgs.enter()
	// .append("svg:image")
	// .attr("xlink:href", "C:/Users/Administrator/Documents/MATLAB/tests/face.jpg")
	// .attr("x", "0")
	// .attr("y", "0")
	// .attr("width", "200")
	// .attr("height", "200");

	// squares.append("rect")
	// .attr("fill", "#d1d1d1")
	// .attr("fill-opacity", 0.7)
	// .attr("width", width / n)
	// .attr("height", height / n);

	// squares.append("svg:image")
	// .attr("xlink:href", "C:/Users/Administrator/Documents/MATLAB/tests/face.jpg")
	// .attr("fill-opacity", 0.7)
	// .attr("width", width / n)
	// .attr("height", height / n);

	d3.selectAll('g').each( function(d, i){ 
		d3.select(this).append("svg:image")
		.attr("xlink:href", d.patch_name)
    // .attr("x", d.x * width)
    // .attr("y", d.y * height)
    .attr("width", width / n)
    .attr("height", height / n)
    .enter();
})

	squares.attr("transform", function(d) {
		return "translate(" + [ d.x * width  , d.y * height   ] + ")"
	});
	var startbtn = d3.select("#startbtn");

	num_clicks = 0
	patching_done = false;
	moving_done = false
	second_click = false
	third_click = false
	
	
	startbtn.on("click", function(){
		num_clicks += 1
		console.log(num_clicks)
		if (num_clicks == 1){
			d3.timer(function(t) {

			time = 4000 // time of animiations in ms
			squares.attr("transform", function(d) {
				
				if (t < time){

					x = d.x - 0.5
					y = d.y - 0.5
					speed = 2.712250*t/time	
					stretch = 80 * speed
					d.x_pos = (x / (speed + 1) * width) + (0.5*width - width/n/2) -width/n + stretch * d.y;
					d.y_pos = (y / (speed + 1) * height) + 0.5*height - height/6 + stretch * d.x
					return "translate(" + [ d.x_pos, d.y_pos] +")"

				} else {
					patching_done = true;
					return "translate(" + [ d.x_pos,  d.y_pos] +")"
				}
			})
			
		})
		}

		if (patching_done & !second_click){

			time_2 = 3000
			second_click = true
			d3.timer(function(t){
				squares.attr("transform", function(d) {
					if (t < time_2) {
						if (d.i == 63) {
							return "translate(" + [ d.x_pos - t * (75/d.x_pos),  d.y_pos - t * (50/d.y_pos) ] +")"
						} else {
							return "translate(" + [ d.x_pos -   t * (100/d.x_pos),  d.y_pos] +")"
						} 
					} else {
						moving_done = true
						if (d.i == 63){
							return "translate(" + [ d.x_pos - time_2 * (75/d.x_pos),  d.y_pos - time_2 * (50/d.y_pos) ] +")"
						} else{
							return "translate(" + [ d.x_pos -   t * (100/d.x_pos),  d.y_pos] +")"
						}
					}
				})
			})
		}

		if (moving_done){

			d3.selectAll('g').each( function(d, i){
				if (d.i == 63){
					patch = d3.select(this)
				}
				else {
					d3.select(this).append("svg:image").attr("xlink:href", "C:/Users/Administrator/Developer/alexandonian.github.io/patches90/class_num_4_image_name_090_patch_7_7_0.png")
					.attr("width", width / n)
    				.attr("height", height / n)
    				.enter()
				}
			})

			time_2 = 3000
			time_3 = 6000
			next_click = true
			i = 0
			d3.timer(function(t){
				if (t < time_3){
				
						squares.attr("transform", function(d){
							if (d.i < t/100){
								return "translate(" + [ width/3 + 4*d.i,  height/6 + 4*d.i] +") rotate(" + [d.i * 10, width / n / 2, height / n / 2] + ")"
							} else{
								return "translate(" + [ -100,  -100] +") "
							}
						})
						patch.attr("transform", function(d) {
							return "translate(" + [ d.x_pos - time_2 * (75/d.x_pos),  d.y_pos - time_2 * (50/d.y_pos) ] +") rotate(" + [t/10, width / n / 2, height / n / 2] + ")"
						})
					
					
				}
				})
				
			}
		})
		
	
	
			// squares.attr("transform", function(d) {
			// 	var r = 360 * (d.x, d.y, t / 10000);
			// 	if (d.y < 0.5 & d.x < 0.5){ // Top-left quadrant
			// 		return "translate(" + [ (d.x * width)/(((t/1000 + 1) / 1)) + width/2,  (d.y * height)/(((t/800+1)/1)) + height/2 - (height / n) ] + ")";
			// 	} else if (d.y < 0.5 & d.x >= 0.5){ // Top-right quadrant
			// 		// return "translate(" + [d.x * width , d.y * height + t/100] + ") rotate(" + [r, width / n / 2, height / n / 2] + ")";
			// 		return "translate(" + [-(d.x * width)/(((t/1000 + 1) / 1)) + width/2,  (d.y * height)/(((t/800+1)/1)) + height/2 - (height / n) ] + ")";
			// 	} else if (d.y >= 0.5 & d.x < 0.5){ // Bottom-left quadrant
			// 		return "translate(" + [ (d.x * width)/(((t/1000 + 1) / 1)) + width/2, -(d.y * height)/(((t/800+1)/1)) + height/2 - (height / n) ] + ")";
			// 	} else if (d.y >= 0.5 & d.x >= 0.5) { // Bottom-right quadrant
			// 		return "translate(" + [-(d.x * width)/(((t/1000 + 1) / 1)) + width/2, -(d.y * height)/(((t/800+1)/1)) + height/2 - (height / n) ] + ")";
			// 	}

			// });
		</script>
